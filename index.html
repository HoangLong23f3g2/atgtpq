Chào bạn, tôi đã cập nhật mã nguồn theo đúng các yêu cầu của bạn:

1. **Thêm Popup đăng nhập:** Khi mở file, người dùng bắt buộc chọn tên từ danh sách (Nguyễn Văn An, Trần Văn Bình, Huỳnh Văn Chương).
2. **Giao diện nút bấm mềm mại hơn:** Sử dụng hiệu ứng gradient (chuyển màu) và bóng đổ nhẹ, giữ nguyên kích thước nhưng nhìn hiện đại hơn.
3. **Kiểm tra nộp bài:** Bắt buộc làm hết câu hỏi mới được nộp.
4. **Gửi dữ liệu về Google Sheets:** Tự động gửi ID, Tên và Điểm số về link bạn cung cấp sau khi nộp bài.

Bạn hãy lưu nội dung dưới đây thành file `.html` (ví dụ: `App_V2.html`) và chạy thử nhé.

```html
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng dụng Bài tập Tiếng Anh & ATGT (Bản Offline V2)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; margin: 0; line-height: 1.5; }
        *, ::before, ::after { box-sizing: border-box; }
        
        /* Tailwind Utilities Simulation */
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .bg-white { background-color: #fff; }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .container { width: 100%; margin-left: auto; margin-right: auto; max-width: 1024px; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .text-2xl { font-size: 1.5rem; }
        .font-bold { font-weight: 700; }
        .text-indigo-600 { color: #4f46e5; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-green-600 { color: #16a34a; }
        .bg-red-500 { background-color: #ef4444; }
        .text-white { color: #fff; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .hover\:bg-red-600:hover { background-color: #dc2626; }
        .transition { transition: all 0.2s ease-in-out; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-8 { margin-top: 2rem; }
        .grid { display: grid; }
        .gap-8 { gap: 2rem; }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .border-l-4 { border-left-width: 4px; }
        .border-purple-500 { border-color: #a855f7; }
        .border-green-500 { border-color: #22c55e; }
        .w-full { width: 100%; }
        .bg-green-500 { background-color: #22c55e; }
        .hidden { display: none !important; }
        .block { display: block; }
        .cursor-pointer { cursor: pointer; }
        .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.5rem; }
        .border { border-width: 1px; border-color: #e5e7eb; }
        .hover\:bg-indigo-50:hover { background-color: #eef2ff; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .text-sm { font-size: 0.875rem; }
        
        /* Custom Styles & Modal */
        .correct-answer { background-color: #d1fae5; border-color: #34d399; }
        .wrong-answer { background-color: #fee2e2; border-color: #f87171; }
        input[type="radio"]:checked + span { font-weight: 700; color: #4f46e5; }

        /* Modal Styles */
        #login-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        /* Nút bấm mềm mại (Gradient & Shadow) */
        .btn-soft {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
            border: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-soft:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px -1px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }
        
        .btn-soft-disabled {
            background: #f3f4f6; color: #9ca3af; border: 1px solid #e5e7eb;
            box-shadow: none; cursor: not-allowed;
        }
        
        /* Responsive Grid */
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="login-modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Chào mừng bạn!</h2>
            <p class="text-gray-600 mb-2">Vui lòng chọn tên của bạn để bắt đầu:</p>
            <select id="user-select" class="w-full p-3 border border-gray-300 rounded-lg mb-6 bg-gray-50 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" disabled selected>-- Chọn tên --</option>
                <option value="Nguyễn Văn An">Nguyễn Văn An</option>
                <option value="Trần Văn Bình">Trần Văn Bình</option>
                <option value="Huỳnh Văn Chương">Huỳnh Văn Chương</option>
            </select>
            <button onclick="handleLogin()" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg">
                Xác nhận & Vào Lớp
            </button>
        </div>
    </div>

    <header class="bg-white shadow-md p-4">
        <div class="container flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600 cursor-pointer" onclick="renderDashboard()">QuizMaster (Offline Mode)</h1>
            <div id="auth-controls">
                <span id="user-display" class="text-gray-700 font-medium">Khách</span>
            </div>
        </div>
    </header>

    <main class="container p-4 flex-grow" id="main-content">
        </main>

    <script>
        // --- DỮ LIỆU ---
        let currentUser = "";
        
        // 1. Danh sách bài thi
        const MOCK_CONTESTS = [
            { id: 27, name: "ATGT: Kỹ năng Đỗ xe (20 câu - ID27)", duration: 20 },
            { id: 26, name: "ATGT: Lùi xe (18 câu)", duration: 60 },
            { id: 800, name: "Danh Từ Đếm Được & Không Đếm Được", duration: 1000 },
            { id: 700, name: "Bài Tập Toán Đố Thực Tế", duration: 20 },
            { id: 600, name: "Toán Học Cơ Bản: Cộng/Trừ/Nhân", duration: 30 }
        ];

        // 2. Chi tiết câu hỏi bài thi ID 27
        const MOCK_EXERCISES_ID27 = [
            { id: 341, question_text: "Hành động nào sau đây 'mời gọi' kẻ gian đập kính trộm đồ?", option_a: "Dán phim cách nhiệt.", option_b: "Để ví tiền, điện thoại, laptop hớ hênh trên ghế phụ.", option_c: "Lắp khóa vô lăng.", option_d: "Gập gương chiếu hậu.", correct_answer: "B", explanation: "Để đồ giá trị nơi dễ nhìn thấy kích thích lòng tham của kẻ gian." },
            { id: 340, question_text: "Để tránh rủi ro xe bị hư hại do môi trường, bạn nên TRÁNH đỗ xe ở đâu?", option_a: "Nơi có bóng mát nhân tạo.", option_b: "Dưới tán cây lớn (nguy cơ gãy cành) hoặc gần công trường (bụi, đinh vít).", option_c: "Trong hầm gửi xe.", option_d: "Nơi có camera an ninh.", correct_answer: "B", explanation: "" },
            { id: 326, question_text: "Hành vi đỗ xe ngược chiều lưu thông (đỗ bên trái đường hai chiều) gây nguy hiểm như thế nào?", option_a: "Không nguy hiểm nếu bật đèn cảnh báo.", option_b: "Chỉ bị phạt hành chính nhẹ.", option_c: "Gây nguy hiểm khi lái xe ra lại làn đường do góc quan sát bị ngược.", option_d: "Làm lốp xe mòn không đều.", correct_answer: "C", explanation: "" },
            { id: 329, question_text: "Khu vực nào sau đây tuyệt đối CẤM đỗ xe?", option_a: "Trước cổng cơ quan hoặc nhà dân.", option_b: "Trên miệng cống thoát nước hoặc trạm xe buýt.", option_c: "Dưới bóng cây.", option_d: "Sát lề đường bên phải.", correct_answer: "B", explanation: "" },
            { id: 336, question_text: "Vật liệu nào sau đây nếu tiếp xúc với ống xả nóng sẽ có nguy cơ bốc cháy cao nhất?", option_a: "Cát và đá dăm.", option_b: "Rơm rạ, lá cây khô, giấy.", option_c: "Nước đọng.", option_d: "Bùn đất.", correct_answer: "B", explanation: "" },
            { id: 330, question_text: "Kỹ thuật 'Dutch Reach' giúp ngăn ngừa tai nạn gì?", option_a: "Tai nạn do quên kéo phanh tay.", option_b: "Tai nạn mở cửa xe gây va chạm cho người đi từ phía sau tới.", option_c: "Tai nạn do điểm mù cột A.", option_d: "Tai nạn do nhầm chân ga.", correct_answer: "B", explanation: "" },
            { id: 337, question_text: "Vụ cháy gần 30 ô tô tại New Zealand (dẫn chứng trong bài) bắt nguồn từ nguyên nhân gì?", option_a: "Do chập điện ắc quy.", option_b: "Do ống xả nóng của xe bán tải chạm vào cỏ khô sau khi lùi.", option_c: "Do rò rỉ nhiên liệu.", option_d: "Do đốt rác gần bãi xe.", correct_answer: "B", explanation: "" },
            { id: 335, question_text: "Tại sao đỗ xe đè lên nắp cống/hố ga lại có nguy cơ gây CHÁY NỔ?", option_a: "Do nắp cống sắc nhọn làm thủng lốp.", option_b: "Do khí metan từ cống tích tụ gặp nhiệt/tia lửa từ gầm xe.", option_c: "Do chuột từ cống chui lên cắn dây điện.", option_d: "Do nắp cống chịu lực kém.", correct_answer: "B", explanation: "" },
            { id: 333, question_text: "Lợi ích chính của việc gập gương chiếu hậu khi đỗ xe lề đường là gì?", option_a: "Tránh bị xe máy lách qua va quẹt làm gãy gương hoặc xước sơn.", option_b: "Để gương không bị bụi bẩn.", option_c: "Để hệ thống điện của xe nghỉ ngơi.", option_d: "Để báo hiệu xe đã khóa.", correct_answer: "A", explanation: "" },
            { id: 332, question_text: "Tại sao bắt buộc phải kéo phanh tay (hoặc về P) ngay cả khi đường 'nhìn có vẻ bằng phẳng'?", option_a: "Để bảo vệ hộp số.", option_b: "Vì mắt thường khó phát hiện độ dốc nhỏ, xe có thể tự trôi gây tai nạn.", option_c: "Để đèn phanh sáng.", option_d: "Để khóa vô lăng.", correct_answer: "B", explanation: "" },
            { id: 325, question_text: "Luật quy định bánh xe gần nhất không được cách lề đường quá khoảng cách bao nhiêu?", option_a: "0.20 mét (20cm).", option_b: "0.25 mét (25cm).", option_c: "0.30 mét (30cm).", option_d: "0.40 mét (40cm).", correct_answer: "B", explanation: "" },
            { id: 334, question_text: "Thói quen đánh lái 'chết' (xoay vô lăng khi xe đứng yên) gây hại gì cho xe?", option_a: "Làm mòn lốp nhanh và hại hệ thống thước lái.", option_b: "Làm tốn xăng.", option_c: "Làm nóng dầu phanh.", option_d: "Làm hỏng hệ thống treo.", correct_answer: "A", explanation: "" },
            { id: 328, question_text: "Khi đỗ xe ở nơi trời tối/thiếu sáng mà xe chiếm một phần đường xe chạy, thao tác bắt buộc là gì?", option_a: "Bật đèn pha (chiếu xa).", option_b: "Bật đèn hậu hoặc đèn cảnh báo nguy hiểm (hazard).", option_c: "Bật đèn xi nhan phải.", option_d: "Tắt hết đèn để tránh hết bình.", correct_answer: "B", explanation: "" },
            { id: 331, question_text: "Thao tác thực hiện kỹ thuật 'Dutch Reach' đúng là gì?", option_a: "Dùng tay trái mở cửa bên trái nhanh chóng.", option_b: "Dùng tay phải mở cửa bên trái (tay xa cửa).", option_c: "Mở hé cửa rồi nhìn qua khe hẹp.", option_d: "Hạ kính xuống trước khi mở cửa.", correct_answer: "B", explanation: "" },
            { id: 327, question_text: "Theo quy định, bạn không được đỗ xe trong phạm vi bao nhiêu mét tính từ mép đường giao nhau (ngã ba, tư)?", option_a: "3 mét.", option_b: "5 mét.", option_c: "10 mét.", option_d: "15 mét.", correct_answer: "B", explanation: "" },
            { id: 324, question_text: "Tại sao việc đỗ xe ngoài đường (lề đường) được cho là rủi ro hơn đỗ trong bãi?", option_a: "Vì tốn phí đỗ xe cao hơn.", option_b: "Vì xe dễ bị bẩn hơn.", option_c: "Vì vừa phải tuân thủ luật, vừa đối mặt với mật độ phương tiện qua lại cao.", option_d: "Vì không có mái che nắng.", correct_answer: "C", explanation: "" },
            { id: 338, question_text: "Khi đỗ xe sát tường (động cơ đang nổ hoặc mới tắt), rủi ro nào có thể xảy ra?", option_a: "Làm hỏng cảm biến lùi.", option_b: "Nhiệt độ khí xả làm biến đổi màu tường hoặc phát sinh lửa.", option_c: "Xe bị kẹt không ra được.", option_d: "Khí thải bay ngược vào xe.", correct_answer: "B", explanation: "" },
            { id: 342, question_text: "Văn hóa đỗ xe tối thiểu khi đỗ nơi công cộng (có thể chắn lối) là gì?", option_a: "Bật đèn pha.", option_b: "Để lại số điện thoại liên hệ trên kính lái.", option_c: "Mở hé cửa kính.", option_d: "Che biển số.", correct_answer: "B", explanation: "" },
            { id: 343, question_text: "Mùi hôi thối lọt vào khoang xe khi đỗ thường do nguyên nhân nào?", option_a: "Đỗ xe gần bãi rác.", option_b: "Đỗ xe đè lên miệng cống/hố ga.", option_c: "Quên đóng kín cửa kính.", option_d: "Hệ thống điều hòa bị hỏng.", correct_answer: "B", explanation: "" },
            { id: 339, question_text: "Tại sao tuyệt đối không được chạm tay vào ống xả ngay khi vừa tắt máy?", option_a: "Vì tay sẽ bị dính muội đen.", option_b: "Vì ống xả và bộ trung hòa khí thải rất nóng, có thể gây bỏng nặng.", option_c: "Vì làm hỏng lớp sơn ống xả.", option_d: "Vì vi phạm quy tắc vận hành.", correct_answer: "B", explanation: "" }
        ];

        // --- HÀM LOGIC ỨNG DỤNG ---

        const mainContent = document.getElementById('main-content');
        let quizAnswers = {};
        let currentContestId = null;

        // Xử lý Login
        function handleLogin() {
            const select = document.getElementById('user-select');
            const val = select.value;
            if(!val) {
                alert("Vui lòng chọn tên để tiếp tục!");
                return;
            }
            currentUser = val;
            document.getElementById('user-display').innerText = `Chào, ${currentUser}`;
            document.getElementById('login-modal').classList.add('hidden');
            renderDashboard();
        }

        // Render Dashboard
        function renderDashboard() {
            mainContent.innerHTML = `
                <div class="flex justify-center mb-8">
                    <h2 class="text-3xl font-extrabold text-gray-800">Bảng Điều Khiển Chính</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                        <h3 class="text-2xl font-bold mb-4 text-green-600">Thi và Luyện Tập</h3>
                        <p class="text-gray-600 mb-4">Danh sách các bài thi đã được tải về.</p>
                        <button onclick="renderContestListPage()" class="w-full bg-green-500 text-white p-3 rounded-lg font-bold hover:bg-green-600 transition shadow-md">
                            Xem Danh Sách Bài Thi
                        </button>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                        <h3 class="text-2xl font-bold mb-4 text-purple-600">Thông tin</h3>
                        <p class="text-gray-600 mb-4">Phiên bản gộp Offline. Dữ liệu bài thi ID 27 đã được nhúng sẵn.</p>
                    </div>
                </div>
                <div id="dynamic-area"></div>
            `;
            renderContestListPage();
        }

        // Render Danh sách bài thi
        function renderContestListPage() {
            const dynamicArea = document.getElementById('dynamic-area');
            if(!dynamicArea) return;

            let html = `
                <div class="bg-white p-8 rounded-xl shadow-2xl mt-8">
                    <h3 class="text-2xl font-bold text-green-600 mb-6 border-b pb-2">Danh Sách Các Bài Thi</h3>
                    <div class="space-y-4">
            `;

            MOCK_CONTESTS.forEach(contest => {
                const isAvailable = contest.id === 27; 
                
                // Nút được thiết kế lại mềm mại hơn
                const buttonHtml = isAvailable 
                    ? `<button onclick="renderQuizPage(${contest.id})" class="btn-soft text-white px-6 py-2 rounded-lg font-semibold text-sm">Luyện tập ngay</button>`
                    : `<button onclick="alert('Bản Offline này chỉ chứa dữ liệu cho bài thi ID 27 (Đỗ xe).')" class="btn-soft-disabled px-6 py-2 rounded-lg font-semibold text-sm">Chưa có dữ liệu</button>`;

                html += `
                    <div class="flex items-center justify-between flex-wrap bg-white p-4 border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition">
                        <div>
                            <h4 class="font-bold text-xl text-gray-800">${contest.name}</h4>
                            <p class="text-sm text-gray-500">Thời gian: ${contest.duration} phút</p>
                        </div>
                        <div class="mt-2 md:mt-0">${buttonHtml}</div>
                    </div>
                `;
            });

            html += `</div></div>`;
            dynamicArea.innerHTML = html;
        }

        // Render Trang làm bài
        function renderQuizPage(contestId) {
            currentContestId = contestId;
            quizAnswers = {};
            const contest = MOCK_CONTESTS.find(c => c.id === contestId);
            const exercises = MOCK_EXERCISES_ID27;

            mainContent.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-2xl mt-8">
                    <h3 class="text-3xl font-bold mb-4 text-center text-indigo-600">${contest.name}</h3>
                    <div class="text-xl font-bold text-green-600 text-center mb-6 p-3 bg-green-50 rounded-lg shadow-inner border border-green-200">
                        Người làm bài: ${currentUser}
                    </div>
                    
                    <form id="quiz-form" onsubmit="event.preventDefault(); handleSubmitQuiz()">
                        <div class="space-y-8 mb-8">
                            ${exercises.map((ex, index) => renderQuestion(ex, index)).join('')}
                        </div>
                        
                        <div class="flex justify-between items-center gap-4">
                            <button type="button" onclick="renderDashboard()" class="flex-1 bg-gray-400 text-white p-3 rounded-lg font-semibold hover:bg-gray-500 transition">
                                Quay lại
                            </button>
                            <button type="submit" class="flex-1 bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition shadow-lg">
                                NỘP BÀI & XEM KẾT QUẢ
                            </button>
                        </div>
                    </form>
                </div>
            `;
            window.scrollTo(0, 0);
        }

        function renderQuestion(ex, index) {
            return `
                <div class="question-item p-4 border border-gray-100 rounded-xl shadow-md bg-white hover:bg-gray-50 transition" id="q-container-${ex.id}">
                    <p class="font-bold text-lg mb-4 text-gray-800">Câu ${index + 1}: ${ex.question_text}</p>
                    <div class="space-y-2">
                        ${['A', 'B', 'C', 'D'].map(opt => `
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50 transition">
                                <input type="radio" name="q-${ex.id}" value="${opt}" onclick="updateAnswer(${ex.id}, '${opt}')" class="h-5 w-5 text-indigo-600">
                                <span class="ml-3 font-medium text-gray-700">${opt}. ${ex[`option_${opt.toLowerCase()}`]}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function updateAnswer(id, val) {
            quizAnswers[id] = val;
            // Xóa báo lỗi nếu có
            const el = document.getElementById(`q-container-${id}`);
            if(el) el.style.borderColor = "#e5e7eb";
        }

        // Xử lý nộp bài
        function handleSubmitQuiz() {
            const exercises = MOCK_EXERCISES_ID27;
            
            // 1. Kiểm tra điền đủ câu hỏi
            const answeredCount = Object.keys(quizAnswers).length;
            if (answeredCount < exercises.length) {
                alert(`Bạn mới làm ${answeredCount}/${exercises.length} câu. Vui lòng hoàn thành tất cả câu hỏi trước khi nộp!`);
                
                // Highlight câu chưa làm
                exercises.forEach(ex => {
                    if(!quizAnswers[ex.id]) {
                        const el = document.getElementById(`q-container-${ex.id}`);
                        if(el) el.style.borderColor = "#ef4444";
                    }
                });
                return;
            }

            if(!confirm("Bạn có chắc chắn muốn nộp bài?")) return;

            // 2. Chấm điểm
            let score = 0;
            exercises.forEach((ex) => {
                if(quizAnswers[ex.id] === ex.correct_answer) score++;
            });
            const total = exercises.length;
            const scoreText = `${score}/${total}`;

            // 3. Gửi dữ liệu về Google Sheets (Link ẩn)
            const googleScriptUrl = "https://script.google.com/macros/s/AKfycbxaSm0voyg3Cjxe3edtc_wOGDko-ysVqQeUPbiLDAWdpbunE5ugn1rq4JD6NHc3pleW3Q/exec";
            // cotA=ID, cotB=Tên, cotC=Kết quả
            const finalUrl = `${googleScriptUrl}?cotA=${currentContestId}&cotB=${encodeURIComponent(currentUser)}&cotC=${scoreText}`;

            // Dùng fetch mode no-cors để gửi lệnh đi mà không cần chờ phản hồi (tránh lỗi CORS trên file local)
            fetch(finalUrl, { mode: 'no-cors' })
                .then(() => console.log("Đã gửi dữ liệu về server"))
                .catch(err => console.error("Lỗi gửi dữ liệu:", err));

            // 4. Hiển thị kết quả
            renderResultPage(exercises, score, total);
        }

        function renderResultPage(exercises, score, total) {
            let resultHtml = `
                <div class="bg-white p-8 rounded-xl shadow-2xl mt-8">
                    <h3 class="text-3xl font-bold mb-4 text-center text-indigo-600">KẾT QUẢ</h3>
                    <div class="p-6 rounded-xl shadow-lg mb-8 ${score/total >= 0.7 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'} text-center font-extrabold text-2xl border-4">
                        Người thi: ${currentUser} <br>
                        Điểm số: ${score} / ${total}
                    </div>
                    <div class="space-y-6">
            `;

            exercises.forEach((ex, index) => {
                const userChoice = quizAnswers[ex.id];
                const isCorrect = userChoice === ex.correct_answer;

                const statusColor = isCorrect ? 'bg-green-500' : 'bg-red-500';
                const containerClass = isCorrect ? 'correct-answer' : 'wrong-answer';

                resultHtml += `
                    <div class="p-4 border-2 rounded-xl shadow-sm ${containerClass}">
                        <p class="font-bold text-lg mb-2 text-gray-800">Câu ${index + 1}: ${ex.question_text}</p>
                        <p class="text-sm font-semibold mb-2"><span class="text-white px-2 py-1 rounded-full ${statusColor}">${isCorrect ? 'Đúng' : 'Sai'}</span></p>
                        
                        <div class="space-y-1 text-sm mb-3">
                            ${['A', 'B', 'C', 'D'].map(opt => {
                                let style = "p-2 rounded-lg ";
                                if(opt === ex.correct_answer) style += "bg-yellow-200 font-bold text-yellow-800 border-l-4 border-yellow-600";
                                else if(opt === userChoice && !isCorrect) style += "bg-red-300 font-bold text-red-900 border-l-4 border-red-700";
                                return `<div class="${style}">${opt}. ${ex[`option_${opt.toLowerCase()}`]}</div>`;
                            }).join('')}
                        </div>
                        <div class="mt-4 p-3 bg-white border border-indigo-200 rounded-lg shadow-inner">
                            <p class="font-bold text-indigo-600 mb-1">Giải thích:</p>
                            <p class="text-gray-700">${ex.explanation || "Không có giải thích."}</p>
                        </div>
                    </div>
                `;
            });

            resultHtml += `
                    </div>
                    <div class="mt-8 flex justify-center">
                        <button onclick="renderDashboard()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-bold shadow-lg hover:bg-indigo-700 transition">Quay về Danh sách</button>
                    </div>
                </div>
            `;

            mainContent.innerHTML = resultHtml;
            window.scrollTo(0, 0);
        }

        // Không gọi renderDashboard ngay mà chờ người dùng đăng nhập
        // window.onload = renderDashboard; (Đã bỏ, thay bằng Modal mặc định hiện)

    </script>
</body>
</html>

```